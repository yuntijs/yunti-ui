"use strict";(self.webpackChunk_yuntijs_ui=self.webpackChunk_yuntijs_ui||[]).push([[6424],{74354:function(tt,L,_){_.d(L,{diagram:function(){return q}});var v=_(37904),et=_(46665),nt=_(75166),at=_(21525),it=_(56843),rt=_(44954),st=_(62859),dt=_(73746),ot=_(49597),ct=_(85565),k=_(68072),t=_(28081),o=_(99177),S=_(17135),R=_(88491),N=_(22123),C=(0,o.eW)(e=>e.append("circle").attr("class","start-state").attr("r",(0,t.nV)().state.sizeUnit).attr("cx",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit).attr("cy",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit),"drawStartState"),H=(0,o.eW)(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",(0,t.nV)().state.textHeight).attr("class","divider").attr("x2",(0,t.nV)().state.textHeight*2).attr("y1",0).attr("y2",0),"drawDivider"),I=(0,o.eW)((e,a)=>{const d=e.append("text").attr("x",2*(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.textHeight+2*(0,t.nV)().state.padding).attr("font-size",(0,t.nV)().state.fontSize).attr("class","state-title").text(a.id),h=d.node().getBBox();return e.insert("rect",":first-child").attr("x",(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.padding).attr("width",h.width+2*(0,t.nV)().state.padding).attr("height",h.height+2*(0,t.nV)().state.padding).attr("rx",(0,t.nV)().state.radius),d},"drawSimpleState"),U=(0,o.eW)((e,a)=>{const d=(0,o.eW)(function(g,B,y){const m=g.append("tspan").attr("x",2*(0,t.nV)().state.padding).text(B);y||m.attr("dy",(0,t.nV)().state.textHeight)},"addTspan"),r=e.append("text").attr("x",2*(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.textHeight+1.3*(0,t.nV)().state.padding).attr("font-size",(0,t.nV)().state.fontSize).attr("class","state-title").text(a.descriptions[0]).node().getBBox(),p=r.height,u=e.append("text").attr("x",(0,t.nV)().state.padding).attr("y",p+(0,t.nV)().state.padding*.4+(0,t.nV)().state.dividerMargin+(0,t.nV)().state.textHeight).attr("class","state-description");let n=!0,s=!0;a.descriptions.forEach(function(g){n||(d(u,g,s),s=!1),n=!1});const V=e.append("line").attr("x1",(0,t.nV)().state.padding).attr("y1",(0,t.nV)().state.padding+p+(0,t.nV)().state.dividerMargin/2).attr("y2",(0,t.nV)().state.padding+p+(0,t.nV)().state.dividerMargin/2).attr("class","descr-divider"),x=u.node().getBBox(),c=Math.max(x.width,r.width);return V.attr("x2",c+3*(0,t.nV)().state.padding),e.insert("rect",":first-child").attr("x",(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.padding).attr("width",c+2*(0,t.nV)().state.padding).attr("height",x.height+p+2*(0,t.nV)().state.padding).attr("rx",(0,t.nV)().state.radius),e},"drawDescrState"),K=(0,o.eW)((e,a,d)=>{const h=(0,t.nV)().state.padding,r=2*(0,t.nV)().state.padding,p=e.node().getBBox(),u=p.width,n=p.x,s=e.append("text").attr("x",0).attr("y",(0,t.nV)().state.titleShift).attr("font-size",(0,t.nV)().state.fontSize).attr("class","state-title").text(a.id),x=s.node().getBBox().width+r;let c=Math.max(x,u);c===u&&(c=c+r);let g;const B=e.node().getBBox();a.doc,g=n-h,x>u&&(g=(u-c)/2+h),Math.abs(n-B.x)<h&&x>u&&(g=n-(x-u)/2);const y=1-(0,t.nV)().state.textHeight;return e.insert("rect",":first-child").attr("x",g).attr("y",y).attr("class",d?"alt-composit":"composit").attr("width",c).attr("height",B.height+(0,t.nV)().state.textHeight+(0,t.nV)().state.titleShift+1).attr("rx","0"),s.attr("x",g+h),x<=u&&s.attr("x",n+(c-r)/2-x/2+h),e.insert("rect",":first-child").attr("x",g).attr("y",(0,t.nV)().state.titleShift-(0,t.nV)().state.textHeight-(0,t.nV)().state.padding).attr("width",c).attr("height",(0,t.nV)().state.textHeight*3).attr("rx",(0,t.nV)().state.radius),e.insert("rect",":first-child").attr("x",g).attr("y",(0,t.nV)().state.titleShift-(0,t.nV)().state.textHeight-(0,t.nV)().state.padding).attr("width",c).attr("height",B.height+3+2*(0,t.nV)().state.textHeight).attr("rx",(0,t.nV)().state.radius),e},"addTitleAndBox"),j=(0,o.eW)(e=>(e.append("circle").attr("class","end-state-outer").attr("r",(0,t.nV)().state.sizeUnit+(0,t.nV)().state.miniPadding).attr("cx",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit+(0,t.nV)().state.miniPadding).attr("cy",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit+(0,t.nV)().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",(0,t.nV)().state.sizeUnit).attr("cx",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit+2).attr("cy",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit+2)),"drawEndState"),z=(0,o.eW)((e,a)=>{let d=(0,t.nV)().state.forkWidth,h=(0,t.nV)().state.forkHeight;if(a.parentId){let r=d;d=h,h=r}return e.append("rect").style("stroke","black").style("fill","black").attr("width",d).attr("height",h).attr("x",(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.padding)},"drawForkJoinState"),Y=(0,o.eW)((e,a,d,h)=>{let r=0;const p=h.append("text");p.style("text-anchor","start"),p.attr("class","noteText");let u=e.replace(/\r\n/g,"<br/>");u=u.replace(/\n/g,"<br/>");const n=u.split(t.SY.lineBreakRegex);let s=1.25*(0,t.nV)().state.noteMargin;for(const V of n){const x=V.trim();if(x.length>0){const c=p.append("tspan");if(c.text(x),s===0){const g=c.node().getBBox();s+=g.height}r+=s,c.attr("x",a+(0,t.nV)().state.noteMargin),c.attr("y",d+r+1.25*(0,t.nV)().state.noteMargin)}}return{textWidth:p.node().getBBox().width,textHeight:r}},"_drawLongText"),G=(0,o.eW)((e,a)=>{a.attr("class","state-note");const d=a.append("rect").attr("x",0).attr("y",(0,t.nV)().state.padding),h=a.append("g"),{textWidth:r,textHeight:p}=Y(e,0,0,h);return d.attr("height",p+2*(0,t.nV)().state.noteMargin),d.attr("width",r+(0,t.nV)().state.noteMargin*2),d},"drawNote"),b=(0,o.eW)(function(e,a){const d=a.id,h={id:d,label:a.id,width:0,height:0},r=e.append("g").attr("id",d).attr("class","stateGroup");a.type==="start"&&C(r),a.type==="end"&&j(r),(a.type==="fork"||a.type==="join")&&z(r,a),a.type==="note"&&G(a.note.text,r),a.type==="divider"&&H(r),a.type==="default"&&a.descriptions.length===0&&I(r,a),a.type==="default"&&a.descriptions.length>0&&U(r,a);const p=r.node().getBBox();return h.width=p.width+2*(0,t.nV)().state.padding,h.height=p.height+2*(0,t.nV)().state.padding,h},"drawState"),D=0,J=(0,o.eW)(function(e,a,d){const h=(0,o.eW)(function(s){switch(s){case v.oI.relationType.AGGREGATION:return"aggregation";case v.oI.relationType.EXTENSION:return"extension";case v.oI.relationType.COMPOSITION:return"composition";case v.oI.relationType.DEPENDENCY:return"dependency"}},"getRelationType");a.points=a.points.filter(s=>!Number.isNaN(s.y));const r=a.points,p=(0,S.jvg)().x(function(s){return s.x}).y(function(s){return s.y}).curve(S.$0Z),u=e.append("path").attr("d",p(r)).attr("id","edge"+D).attr("class","transition");let n="";if((0,t.nV)().state.arrowMarkerAbsolute&&(n=(0,t.Gr)(!0)),u.attr("marker-end","url("+n+"#"+h(v.oI.relationType.DEPENDENCY)+"End)"),d.title!==void 0){const s=e.append("g").attr("class","stateLabel"),{x:V,y:x}=k.w8.calcLabelPosition(a.points),c=t.SY.getRows(d.title);let g=0;const B=[];let y=0,m=0;for(let i=0;i<=c.length;i++){const f=s.append("text").attr("text-anchor","middle").text(c[i]).attr("x",V).attr("y",x+g),l=f.node().getBBox();y=Math.max(y,l.width),m=Math.min(m,l.x),o.cM.info(l.x,V,x+g),g===0&&(g=f.node().getBBox().height,o.cM.info("Title height",g,x)),B.push(f)}let W=g*c.length;if(c.length>1){const i=(c.length-1)*g*.5;B.forEach((f,l)=>f.attr("y",x+l*g-i)),W=g*c.length}const P=s.node().getBBox();s.insert("rect",":first-child").attr("class","box").attr("x",V-y/2-(0,t.nV)().state.padding/2).attr("y",x-W/2-(0,t.nV)().state.padding/2-3.5).attr("width",y+(0,t.nV)().state.padding).attr("height",W+(0,t.nV)().state.padding),o.cM.info(P)}D++},"drawEdge"),E,T={},F=(0,o.eW)(function(){},"setConf"),X=(0,o.eW)(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),Z=(0,o.eW)(function(e,a,d,h){E=(0,t.nV)().state;const r=(0,t.nV)().securityLevel;let p;r==="sandbox"&&(p=(0,S.Ys)("#i"+a));const u=r==="sandbox"?(0,S.Ys)(p.nodes()[0].contentDocument.body):(0,S.Ys)("body"),n=r==="sandbox"?p.nodes()[0].contentDocument:document;o.cM.debug("Rendering diagram "+e);const s=u.select(`[id='${a}']`);X(s);const V=h.db.getRootDoc();A(V,s,void 0,!1,u,n,h);const x=E.padding,c=s.node().getBBox(),g=c.width+x*2,B=c.height+x*2,y=g*1.75;(0,t.v2)(s,B,y,E.useMaxWidth),s.attr("viewBox",`${c.x-E.padding}  ${c.y-E.padding} `+g+" "+B)},"draw"),$=(0,o.eW)(e=>e?e.length*E.fontSizeFactor:1,"getLabelWidth"),A=(0,o.eW)((e,a,d,h,r,p,u)=>{const n=new N.k({compound:!0,multigraph:!0});let s,V=!0;for(s=0;s<e.length;s++)if(e[s].stmt==="relation"){V=!1;break}d?n.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:V?1:E.edgeLengthFactor,nodeSep:V?1:50,isMultiGraph:!0}):n.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:V?1:E.edgeLengthFactor,nodeSep:V?1:50,ranker:"tight-tree",isMultiGraph:!0}),n.setDefaultEdgeLabel(function(){return{}});const x=u.db.getStates(),c=u.db.getRelations(),g=Object.keys(x);let B=!0;for(const i of g){const f=x[i];d&&(f.parentId=d);let l;if(f.doc){let M=a.append("g").attr("id",f.id).attr("class","stateGroup");if(l=A(f.doc,M,f.id,!h,r,p,u),B){M=K(M,f,h);let w=M.node().getBBox();l.width=w.width,l.height=w.height+E.padding/2,T[f.id]={y:E.compositTitleSize}}else{let w=M.node().getBBox();l.width=w.width,l.height=w.height}}else l=b(a,f,n);if(f.note){const M={descriptions:[],id:f.id+"-note",note:f.note,type:"note"},w=b(a,M,n);f.note.position==="left of"?(n.setNode(l.id+"-note",w),n.setNode(l.id,l)):(n.setNode(l.id,l),n.setNode(l.id+"-note",w)),n.setParent(l.id,l.id+"-group"),n.setParent(l.id+"-note",l.id+"-group")}else n.setNode(l.id,l)}o.cM.debug("Count=",n.nodeCount(),n);let y=0;c.forEach(function(i){y++,o.cM.debug("Setting edge",i),n.setEdge(i.id1,i.id2,{relation:i,width:$(i.title),height:E.labelHeight*t.SY.getRows(i.title).length,labelpos:"c"},"id"+y)}),(0,R.bK)(n),o.cM.debug("Graph after layout",n.nodes());const m=a.node();n.nodes().forEach(function(i){i!==void 0&&n.node(i)!==void 0?(o.cM.warn("Node "+i+": "+JSON.stringify(n.node(i))),r.select("#"+m.id+" #"+i).attr("transform","translate("+(n.node(i).x-n.node(i).width/2)+","+(n.node(i).y+(T[i]?T[i].y:0)-n.node(i).height/2)+" )"),r.select("#"+m.id+" #"+i).attr("data-x-shift",n.node(i).x-n.node(i).width/2),p.querySelectorAll("#"+m.id+" #"+i+" .divider").forEach(l=>{const M=l.parentElement;let w=0,O=0;M&&(M.parentElement&&(w=M.parentElement.getBBox().width),O=parseInt(M.getAttribute("data-x-shift"),10),Number.isNaN(O)&&(O=0)),l.setAttribute("x1",0-O+8),l.setAttribute("x2",w-O-8)})):o.cM.debug("No Node "+i+": "+JSON.stringify(n.node(i)))});let W=m.getBBox();n.edges().forEach(function(i){i!==void 0&&n.edge(i)!==void 0&&(o.cM.debug("Edge "+i.v+" -> "+i.w+": "+JSON.stringify(n.edge(i))),J(a,n.edge(i),n.edge(i).relation))}),W=m.getBBox();const P={id:d||"root",label:d||"root",width:0,height:0};return P.width=W.width+2*E.padding,P.height=W.height+2*E.padding,o.cM.debug("Doc rendered",P,n),P},"renderDoc"),Q={setConf:F,draw:Z},q={parser:v.J8,get db(){return new v.oI(1)},renderer:Q,styles:v.Ee,init:(0,o.eW)(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")}}}]);
