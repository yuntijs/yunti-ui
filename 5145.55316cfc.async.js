"use strict";(self.webpackChunk_yuntijs_ui=self.webpackChunk_yuntijs_ui||[]).push([[5145],{5145:function(rt,H,_){_.d(H,{diagram:function(){return it}});var m=_(11745),st=_(12764),dt=_(70952),ot=_(4638),ct=_(52121),ht=_(81295),gt=_(99858),lt=_(73395),pt=_(17549),N=_(35934),t=_(95895),b=_(76e3),R=_(88491),U=_(22123),P={},A=(0,t.eW)((e,a)=>{P[e]=a},"set"),C=(0,t.eW)(e=>P[e],"get"),k=(0,t.eW)(()=>Object.keys(P),"keys"),I=(0,t.eW)(()=>k().length,"size"),z={get:C,set:A,keys:k,size:I},K=(0,t.eW)(e=>e.append("circle").attr("class","start-state").attr("r",(0,t.nV)().state.sizeUnit).attr("cx",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit).attr("cy",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit),"drawStartState"),j=(0,t.eW)(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",(0,t.nV)().state.textHeight).attr("class","divider").attr("x2",(0,t.nV)().state.textHeight*2).attr("y1",0).attr("y2",0),"drawDivider"),Y=(0,t.eW)((e,a)=>{const d=e.append("text").attr("x",2*(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.textHeight+2*(0,t.nV)().state.padding).attr("font-size",(0,t.nV)().state.fontSize).attr("class","state-title").text(a.id),o=d.node().getBBox();return e.insert("rect",":first-child").attr("x",(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.padding).attr("width",o.width+2*(0,t.nV)().state.padding).attr("height",o.height+2*(0,t.nV)().state.padding).attr("rx",(0,t.nV)().state.radius),d},"drawSimpleState"),G=(0,t.eW)((e,a)=>{const d=(0,t.eW)(function(h,E,y){const M=h.append("tspan").attr("x",2*(0,t.nV)().state.padding).text(E);y||M.attr("dy",(0,t.nV)().state.textHeight)},"addTspan"),r=e.append("text").attr("x",2*(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.textHeight+1.3*(0,t.nV)().state.padding).attr("font-size",(0,t.nV)().state.fontSize).attr("class","state-title").text(a.descriptions[0]).node().getBBox(),l=r.height,p=e.append("text").attr("x",(0,t.nV)().state.padding).attr("y",l+(0,t.nV)().state.padding*.4+(0,t.nV)().state.dividerMargin+(0,t.nV)().state.textHeight).attr("class","state-description");let n=!0,s=!0;a.descriptions.forEach(function(h){n||(d(p,h,s),s=!1),n=!1});const f=e.append("line").attr("x1",(0,t.nV)().state.padding).attr("y1",(0,t.nV)().state.padding+l+(0,t.nV)().state.dividerMargin/2).attr("y2",(0,t.nV)().state.padding+l+(0,t.nV)().state.dividerMargin/2).attr("class","descr-divider"),x=p.node().getBBox(),c=Math.max(x.width,r.width);return f.attr("x2",c+3*(0,t.nV)().state.padding),e.insert("rect",":first-child").attr("x",(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.padding).attr("width",c+2*(0,t.nV)().state.padding).attr("height",x.height+l+2*(0,t.nV)().state.padding).attr("rx",(0,t.nV)().state.radius),e},"drawDescrState"),F=(0,t.eW)((e,a,d)=>{const o=(0,t.nV)().state.padding,r=2*(0,t.nV)().state.padding,l=e.node().getBBox(),p=l.width,n=l.x,s=e.append("text").attr("x",0).attr("y",(0,t.nV)().state.titleShift).attr("font-size",(0,t.nV)().state.fontSize).attr("class","state-title").text(a.id),x=s.node().getBBox().width+r;let c=Math.max(x,p);c===p&&(c=c+r);let h;const E=e.node().getBBox();a.doc,h=n-o,x>p&&(h=(p-c)/2+o),Math.abs(n-E.x)<o&&x>p&&(h=n-(x-p)/2);const y=1-(0,t.nV)().state.textHeight;return e.insert("rect",":first-child").attr("x",h).attr("y",y).attr("class",d?"alt-composit":"composit").attr("width",c).attr("height",E.height+(0,t.nV)().state.textHeight+(0,t.nV)().state.titleShift+1).attr("rx","0"),s.attr("x",h+o),x<=p&&s.attr("x",n+(c-r)/2-x/2+o),e.insert("rect",":first-child").attr("x",h).attr("y",(0,t.nV)().state.titleShift-(0,t.nV)().state.textHeight-(0,t.nV)().state.padding).attr("width",c).attr("height",(0,t.nV)().state.textHeight*3).attr("rx",(0,t.nV)().state.radius),e.insert("rect",":first-child").attr("x",h).attr("y",(0,t.nV)().state.titleShift-(0,t.nV)().state.textHeight-(0,t.nV)().state.padding).attr("width",c).attr("height",E.height+3+2*(0,t.nV)().state.textHeight).attr("rx",(0,t.nV)().state.radius),e},"addTitleAndBox"),J=(0,t.eW)(e=>(e.append("circle").attr("class","end-state-outer").attr("r",(0,t.nV)().state.sizeUnit+(0,t.nV)().state.miniPadding).attr("cx",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit+(0,t.nV)().state.miniPadding).attr("cy",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit+(0,t.nV)().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",(0,t.nV)().state.sizeUnit).attr("cx",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit+2).attr("cy",(0,t.nV)().state.padding+(0,t.nV)().state.sizeUnit+2)),"drawEndState"),X=(0,t.eW)((e,a)=>{let d=(0,t.nV)().state.forkWidth,o=(0,t.nV)().state.forkHeight;if(a.parentId){let r=d;d=o,o=r}return e.append("rect").style("stroke","black").style("fill","black").attr("width",d).attr("height",o).attr("x",(0,t.nV)().state.padding).attr("y",(0,t.nV)().state.padding)},"drawForkJoinState"),Z=(0,t.eW)((e,a,d,o)=>{let r=0;const l=o.append("text");l.style("text-anchor","start"),l.attr("class","noteText");let p=e.replace(/\r\n/g,"<br/>");p=p.replace(/\n/g,"<br/>");const n=p.split(t.SY.lineBreakRegex);let s=1.25*(0,t.nV)().state.noteMargin;for(const f of n){const x=f.trim();if(x.length>0){const c=l.append("tspan");if(c.text(x),s===0){const h=c.node().getBBox();s+=h.height}r+=s,c.attr("x",a+(0,t.nV)().state.noteMargin),c.attr("y",d+r+1.25*(0,t.nV)().state.noteMargin)}}return{textWidth:l.node().getBBox().width,textHeight:r}},"_drawLongText"),$=(0,t.eW)((e,a)=>{a.attr("class","state-note");const d=a.append("rect").attr("x",0).attr("y",(0,t.nV)().state.padding),o=a.append("g"),{textWidth:r,textHeight:l}=Z(e,0,0,o);return d.attr("height",l+2*(0,t.nV)().state.noteMargin),d.attr("width",r+(0,t.nV)().state.noteMargin*2),d},"drawNote"),T=(0,t.eW)(function(e,a){const d=a.id,o={id:d,label:a.id,width:0,height:0},r=e.append("g").attr("id",d).attr("class","stateGroup");a.type==="start"&&K(r),a.type==="end"&&J(r),(a.type==="fork"||a.type==="join")&&X(r,a),a.type==="note"&&$(a.note.text,r),a.type==="divider"&&j(r),a.type==="default"&&a.descriptions.length===0&&Y(r,a),a.type==="default"&&a.descriptions.length>0&&G(r,a);const l=r.node().getBBox();return o.width=l.width+2*(0,t.nV)().state.padding,o.height=l.height+2*(0,t.nV)().state.padding,z.set(d,o),o},"drawState"),D=0,Q=(0,t.eW)(function(e,a,d){const o=(0,t.eW)(function(s){switch(s){case m.bH.relationType.AGGREGATION:return"aggregation";case m.bH.relationType.EXTENSION:return"extension";case m.bH.relationType.COMPOSITION:return"composition";case m.bH.relationType.DEPENDENCY:return"dependency"}},"getRelationType");a.points=a.points.filter(s=>!Number.isNaN(s.y));const r=a.points,l=(0,b.jvg)().x(function(s){return s.x}).y(function(s){return s.y}).curve(b.$0Z),p=e.append("path").attr("d",l(r)).attr("id","edge"+D).attr("class","transition");let n="";if((0,t.nV)().state.arrowMarkerAbsolute&&(n=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,n=n.replace(/\(/g,"\\("),n=n.replace(/\)/g,"\\)")),p.attr("marker-end","url("+n+"#"+o(m.bH.relationType.DEPENDENCY)+"End)"),d.title!==void 0){const s=e.append("g").attr("class","stateLabel"),{x:f,y:x}=N.w8.calcLabelPosition(a.points),c=t.SY.getRows(d.title);let h=0;const E=[];let y=0,M=0;for(let i=0;i<=c.length;i++){const u=s.append("text").attr("text-anchor","middle").text(c[i]).attr("x",f).attr("y",x+h),g=u.node().getBBox();y=Math.max(y,g.width),M=Math.min(M,g.x),t.cM.info(g.x,f,x+h),h===0&&(h=u.node().getBBox().height,t.cM.info("Title height",h,x)),E.push(u)}let v=h*c.length;if(c.length>1){const i=(c.length-1)*h*.5;E.forEach((u,g)=>u.attr("y",x+g*h-i)),v=h*c.length}const W=s.node().getBBox();s.insert("rect",":first-child").attr("class","box").attr("x",f-y/2-(0,t.nV)().state.padding/2).attr("y",x-v/2-(0,t.nV)().state.padding/2-3.5).attr("width",y+(0,t.nV)().state.padding).attr("height",v+(0,t.nV)().state.padding),t.cM.info(W)}D++},"drawEdge"),V,O={},q=(0,t.eW)(function(){},"setConf"),tt=(0,t.eW)(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),et=(0,t.eW)(function(e,a,d,o){V=(0,t.nV)().state;const r=(0,t.nV)().securityLevel;let l;r==="sandbox"&&(l=(0,b.Ys)("#i"+a));const p=r==="sandbox"?(0,b.Ys)(l.nodes()[0].contentDocument.body):(0,b.Ys)("body"),n=r==="sandbox"?l.nodes()[0].contentDocument:document;t.cM.debug("Rendering diagram "+e);const s=p.select(`[id='${a}']`);tt(s);const f=o.db.getRootDoc();L(f,s,void 0,!1,p,n,o);const x=V.padding,c=s.node().getBBox(),h=c.width+x*2,E=c.height+x*2,y=h*1.75;(0,t.v2)(s,E,y,V.useMaxWidth),s.attr("viewBox",`${c.x-V.padding}  ${c.y-V.padding} `+h+" "+E)},"draw"),nt=(0,t.eW)(e=>e?e.length*V.fontSizeFactor:1,"getLabelWidth"),L=(0,t.eW)((e,a,d,o,r,l,p)=>{const n=new U.k({compound:!0,multigraph:!0});let s,f=!0;for(s=0;s<e.length;s++)if(e[s].stmt==="relation"){f=!1;break}d?n.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:f?1:V.edgeLengthFactor,nodeSep:f?1:50,isMultiGraph:!0}):n.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:f?1:V.edgeLengthFactor,nodeSep:f?1:50,ranker:"tight-tree",isMultiGraph:!0}),n.setDefaultEdgeLabel(function(){return{}}),p.db.extract(e);const x=p.db.getStates(),c=p.db.getRelations(),h=Object.keys(x);let E=!0;for(const i of h){const u=x[i];d&&(u.parentId=d);let g;if(u.doc){let B=a.append("g").attr("id",u.id).attr("class","stateGroup");if(g=L(u.doc,B,u.id,!o,r,l,p),E){B=F(B,u,o);let w=B.node().getBBox();g.width=w.width,g.height=w.height+V.padding/2,O[u.id]={y:V.compositTitleSize}}else{let w=B.node().getBBox();g.width=w.width,g.height=w.height}}else g=T(a,u,n);if(u.note){const B={descriptions:[],id:u.id+"-note",note:u.note,type:"note"},w=T(a,B,n);u.note.position==="left of"?(n.setNode(g.id+"-note",w),n.setNode(g.id,g)):(n.setNode(g.id,g),n.setNode(g.id+"-note",w)),n.setParent(g.id,g.id+"-group"),n.setParent(g.id+"-note",g.id+"-group")}else n.setNode(g.id,g)}t.cM.debug("Count=",n.nodeCount(),n);let y=0;c.forEach(function(i){y++,t.cM.debug("Setting edge",i),n.setEdge(i.id1,i.id2,{relation:i,width:nt(i.title),height:V.labelHeight*t.SY.getRows(i.title).length,labelpos:"c"},"id"+y)}),(0,R.bK)(n),t.cM.debug("Graph after layout",n.nodes());const M=a.node();n.nodes().forEach(function(i){i!==void 0&&n.node(i)!==void 0?(t.cM.warn("Node "+i+": "+JSON.stringify(n.node(i))),r.select("#"+M.id+" #"+i).attr("transform","translate("+(n.node(i).x-n.node(i).width/2)+","+(n.node(i).y+(O[i]?O[i].y:0)-n.node(i).height/2)+" )"),r.select("#"+M.id+" #"+i).attr("data-x-shift",n.node(i).x-n.node(i).width/2),l.querySelectorAll("#"+M.id+" #"+i+" .divider").forEach(g=>{const B=g.parentElement;let w=0,S=0;B&&(B.parentElement&&(w=B.parentElement.getBBox().width),S=parseInt(B.getAttribute("data-x-shift"),10),Number.isNaN(S)&&(S=0)),g.setAttribute("x1",0-S+8),g.setAttribute("x2",w-S-8)})):t.cM.debug("No Node "+i+": "+JSON.stringify(n.node(i)))});let v=M.getBBox();n.edges().forEach(function(i){i!==void 0&&n.edge(i)!==void 0&&(t.cM.debug("Edge "+i.v+" -> "+i.w+": "+JSON.stringify(n.edge(i))),Q(a,n.edge(i),n.edge(i).relation))}),v=M.getBBox();const W={id:d||"root",label:d||"root",width:0,height:0};return W.width=v.width+2*V.padding,W.height=v.height+2*V.padding,t.cM.debug("Doc rendered",W,n),W},"renderDoc"),at={setConf:q,draw:et},it={parser:m.J8,db:m.bH,renderer:at,styles:m.Ee,init:(0,t.eW)(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,m.bH.clear()},"init")}}}]);
